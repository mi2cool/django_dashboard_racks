{% load static %}

<div class="text-center" style="font-size: 14px">
    <div id="progress-bar-message">
{#        Enter URL and click the "Download" button#}
    </div>
</div>
<div class='progress-wrapper' style="padding-top: 10px;">
    <div id='progress-bar' class='progress-bar progress-bar-striped' role='progressbar'
         style="height:30px; width: 0%; border-radius: 5px">&nbsp;
    </div>
</div>
<div id="celery-result">
</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script src="{% static 'celery_progress/celery_progress.js' %}"></script>

{% if task_id %}

    <script type="text/javascript">

        $(document).ready(function () {

            function processProgress(progressBarElement, progressBarMessageElement, progress) {
                progressBarElement.style.width = progress.percent + "%";
                progressBarElement.style.backgroundColor = this.barColors.progress;
                var description = progress.description || "Starting download";
                progressBarMessageElement.innerHTML = description;
            }

            function processResult(resultElement, result) {

                if (result !== undefined && result !== null) {
                    if (result.includes("successful")) {
                        $(resultElement).append(
                            $('<br>')
                        );
                        $(resultElement).append(
                            $('<p class="text-center">').text(result)
                        );
                    }
                }
            }

            // Progress Bar (JQuery)
            $(function () {
                var progressUrl = "{% url 'celery_progress:task_status' task_id %}";
                CeleryProgressBar.initProgressBar(progressUrl, {
                    onProgress: processProgress,
                    onResult: processResult,
                })
            });
        });
    </script>

{% endif %}

